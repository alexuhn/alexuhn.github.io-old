---
title: "[운영체제-양희재 교수님]13강 생산자-소비자 문제"
excerpt: "생산자-소비자 문제에 대하여"
categories:
  - lecture_notes
tags:
  - 운영체제-양희재 교수님
---

[경성대학교 양희재 교수님의 운영체제 13강](http://www.kocw.net/home/cview.do?lid=944c064434bac45c)

# 전통적 동기화 예제

- Producer and Consumer Problem(생산자-소비자 문제)
    - 유한 버퍼 문제(Bounded Buffer Problem)라고도 한다.
- Readers-Writers Problem
    - 공유 데이터베이스 접근에서 발생하는 문제
- Dining Philosopher Problem
    - 식사하는 철학자 문제

# Producer-Consumer Problem

- 생산자-소비자 문제
    - 생산자가 데이터를 생산하면 소비자는 그것을 소비
    - 예) 컴파일러(어셈블리 코드 생산) → 어셈블러(어셈블리 코드 소비)
    - 예) 파일 서버(HTML 생산) → 클라이언트(HTML 소비)
- Bounded Buffer
    - 생산과 소비의 속도는 다르다 ⇒ 생산된 데이터는 버퍼에 저장
    - 현실 시스템에서 버퍼 크기는 유한(Bounded Buffer)
        - 생산자는 버퍼가 가득 차면 더 넣을 수 없다.
        - 소비자는 버퍼가 비면 뺄 수 없다.

## 첫 번째 문제

- 최종적으로 버퍼 내에는 0개의 항목이 있어야 하지만 잘못된 결과가 나온다.
    - 잘못된 결과
        - 실행이 불가한 경우
        - `count ≠ 0`(생산된 항목 숫자 ≠ 소비된 항목 숫자)인 경우

### 원인

- 공통변수 `count`, `buf[]`에 대한 동시 업데이트
- 공통변수 업데이트 구간(임계구역)에 대한 동시 진입

### 해결

- 임계구역에 대한 동시 접근 방지(상호배타)
    - 세마포를 사용한 상호배타(mutual exclusion)
        
        ```java
        // mutual exclusion semaphore => mutex
        mutex.value = 1 // # of permit
        ```
        
        ```java
        Producer             Consumer
        
        mutex.acquire()      mutex.acquire()
        Critical Section     Critical Section
        mutex.release()      mutex.release()
        ```
        

## 두 번째 문제

- Busy-wait
    - 생산자는 버퍼가 가득 차면 빈(empty) 공간이 나올 때까지 기다려야 한다.
    - 소비자는 버퍼가 비면 찬(full) 공간이 있을 때까지 기다려야 한다.
    - CPU는 아무 일도 하지 못한 채 기다려야 한다 ⇒ 낭비 ⇒ CPU 효율 감소

### 해결

- 세마포를 사용한 busy-wait 회피
    - 생산자 ⇒ 버퍼가 가득 차면 빈(empty) 공간이 나올 때까지 block 시킨다.
        
        ```java
        empty.acquire() // # of permit = BUF_SIZE
        ```
        
        ```java
        Producer             Consumer
        
        empty.acquire()
        mutex.acquire()      mutex.acquire()
        Critical Section     Critical Section
        mutex.release()      mutex.release()
                             empty.release()
        ```
        
    - 소비자 ⇒ 버퍼가 비면 찬(full) 공간이 있을 때까지 block 시킨다.
        
        ```java
        full.acquire() // # of permit = 0, 처음에 소비할 수 있는 게 없기 때문
        ```
        
        ```java
        Producer             Consumer
        
        empty.acquire()      full.acquire()
        mutex.acquire()      mutex.acquire()
        Critical Section     Critical Section
        mutex.release()      mutex.release()
        full.release()       empty.release()
        ```